@page "/products"
@using WebApp.Data
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@rendermode InteractiveServer

<h3>ğŸ’ãƒãƒƒã‚¯ãƒ‘ãƒƒã‚¯ä¸€è¦§ğŸ’</h3>

<QuickGrid TGridItem="Product"
           ItemsProvider="@ProvideProductsAsync"
           Pagination="@paginationState">
    <PropertyColumn Property="@(p => p.id)" Title="ID" />
    <PropertyColumn Property="@(p => p.brand)" Title="ãƒ–ãƒ©ãƒ³ãƒ‰" />
    <PropertyColumn Property="@(p => p.price)" Title="ä¾¡æ ¼($)" />
    <PropertyColumn Property="@(p => p.weight_capacity_kg)" Title="å®¹é‡(kg)" />
    <PropertyColumn Property="@(p => p.waterproof)" Title="æ’¥æ°´" />
    <PropertyColumn Property="@(p => p.size)" Title="ã‚µã‚¤ã‚º" />
    <PropertyColumn Property="@(p => p.color)" Title="ã‚«ãƒ©ãƒ¼" />
    <PropertyColumn Property="@(p => p.style)" Title="ã‚¹ã‚¿ã‚¤ãƒ«" />
    <PropertyColumn Property="@(p => p.compartments)" Title="åç´ã‚¹ãƒšãƒ¼ã‚¹æ•°" />
</QuickGrid>

<Paginator State="@paginationState" />

@code {
    private readonly PaginationState paginationState = new() { ItemsPerPage = 10 };

    [Inject]
    private AppDbContext Db { get; set; } = default!;

    private async ValueTask<GridItemsProviderResult<Product>> ProvideProductsAsync(GridItemsProviderRequest<Product> request)
    {
        var query = Db.Products.AsNoTracking();
        var total = await query.CountAsync();

        var items = await query
            .Skip(request.StartIndex)
            .Take(request.Count ?? 10)
            .ToListAsync();

        return new GridItemsProviderResult<Product>
        {
            Items = items,
            TotalItemCount = total
        };
    }
}