@page "/products"
@using Microsoft.AspNetCore.Components.QuickGrid
@using Microsoft.EntityFrameworkCore
@using WebApp.Data
@rendermode InteractiveServer

<h3>üéí„Éê„ÉÉ„ÇØ„Éë„ÉÉ„ÇØ‰∏ÄË¶ßüéí</h3>

<QuickGrid TGridItem="Product"
           ItemsProvider="@ProvideProductsAsync"
           Pagination="@paginationState">
    <PropertyColumn Property="@(p => p.id)" Title="ID"/>
    <PropertyColumn Property="@(p => p.brand)" Title="„Éñ„É©„É≥„Éâ"/>
    <PropertyColumn Property="@(p => p.price.ToString("F0"))" Title="‰æ°Ê†º($)"/>
    <PropertyColumn Property="@(p => p.weight_capacity_kg.ToString("F2"))" Title="ÂÆπÈáè(kg)"/>
    <PropertyColumn Property="@(p => p.waterproof)" Title="Êí•Ê∞¥"/>
    <PropertyColumn Property="@(p => p.size)" Title="„Çµ„Ç§„Ç∫"/>
    <PropertyColumn Property="@(p => p.color)" Title="„Ç´„É©„Éº"/>
    <PropertyColumn Property="@(p => p.style)" Title="„Çπ„Çø„Ç§„É´"/>
    <PropertyColumn Property="@(p => p.compartments)" Title="ÂèéÁ¥çÊï∞"/>

    <TemplateColumn Title="Êìç‰Ωú">
        <div class="d-flex gap-1„ÄÄflex-nowrap">
            <NavLink class="btn btn-sm btn-outline-primary w-auto" href="@($"/products/edit/{context.id}")">
                Edit
            </NavLink>
            <NavLink class="btn btn-sm btn-outline-danger w-auto" href="@($"/products/delete/{context.id}")">
                Delete
            </NavLink>
        </div>
    </TemplateColumn>

</QuickGrid>



<Paginator State="@paginationState"/>

@code {
    private readonly PaginationState paginationState = new() { ItemsPerPage = 10 };

    [Inject] private AppDbContext Db { get; set; } = default!;

    private async ValueTask<GridItemsProviderResult<Product>> ProvideProductsAsync(GridItemsProviderRequest<Product> request)
    {
        var query = Db.Products.AsNoTracking();
        var total = await query.CountAsync();

        var items = await query
            .Skip(request.StartIndex)
            .Take(request.Count ?? 10)
            .ToListAsync();

        return new GridItemsProviderResult<Product>
        {
            Items = items,
            TotalItemCount = total
        };
    }

}